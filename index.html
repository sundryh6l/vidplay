<html><head><base href="." />
<meta charset="UTF-8" />
<link rel="icon" type="image/png" href="https://i.ibb.co/gzmYSPg/vidplay.png">
<title>Local Video Player Extension</title>
<style>
body {
  margin: 0;
  padding: 0;
  font-family: Arial, sans-serif;
  background: #141414;
  color: #ffffff;
}

#video-container {
  width: 100%;
  max-width: 1800px;
  margin: 20px auto;
  transition: margin 0.3s ease;
}

#controls {
  position: sticky;
  top: 0;
  z-index: 1000;
  width: 100%;
  max-width: 800px;
  margin: 0 auto;
  padding: 10px;
  background: rgba(0,0,0,0.8);
  display: flex;
  align-items: center;
  gap: 10px;
}

#video {
  width: 100%;
  background: #000;
}

button {
  padding: 8px 15px;
  background: #E50914;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

button:hover {
  background: #F40612;
}

label {
  color: #fff;
  cursor: pointer;
}

#file-input {
  display: none;
}

#time-display {
  margin-left: auto;
  color: #fff;
}

/* Hidden history display */
#history-display {
  display: none;
}
</style>
</head>
<body>
<div id="controls">
  <label for="file-input">Choose Video</label>
  <input type="file" id="file-input" accept="video/*">
  <button id="play-pause">Play</button>
  <button id="rewind">Rewind 10s</button>
  <button id="forward">Forward 10s</button>
  <span id="time-display">0:00 / 0:00</span>
</div>

<div id="video-container">
  <video id="video" controls></video>
</div>

<div id="history-display"></div>

<script>
const video = document.getElementById('video');
const fileInput = document.getElementById('file-input');
const playPauseButton = document.getElementById('play-pause');
const rewindButton = document.getElementById('rewind');
const forwardButton = document.getElementById('forward');
const timeDisplay = document.getElementById('time-display');

// Initialize video history in localStorage if it doesn't exist
if (!localStorage.getItem('videoHistory')) {
    localStorage.setItem('videoHistory', JSON.stringify([]));
}

function updateVideoHistory(filename, currentTime) {
    let history = JSON.parse(localStorage.getItem('videoHistory'));
    
    // Remove the entry if it already exists
    history = history.filter(item => item.filename !== filename);
    
    // Add new entry at the beginning
    history.unshift({
        filename: filename,
        timestamp: currentTime,
        date: new Date().toISOString()
    });
    
    // Keep only last 5 entries
    history = history.slice(0, 5);
    
    localStorage.setItem('videoHistory', JSON.stringify(history));
}

fileInput.addEventListener('change', (event) => {
    const file = event.target.files[0];
    if (file) {
        const fileURL = URL.createObjectURL(file);
        video.src = fileURL;
        
        // Check if this video exists in history
        const history = JSON.parse(localStorage.getItem('videoHistory'));
        const previousEntry = history.find(item => item.filename === file.name);
        
        if (previousEntry) {
            video.currentTime = previousEntry.timestamp;
            // alert(`Resuming from ${formatTime(previousEntry.timestamp)}`);
        }
        
        video.play();
        playPauseButton.textContent = 'Pause';
    }
});

// Save timestamp every 5 seconds during playback
video.addEventListener('timeupdate', () => {
    const currentTime = formatTime(video.currentTime);
    const duration = formatTime(video.duration);
    timeDisplay.textContent = `${currentTime} / ${duration}`;
    
    if (Math.floor(video.currentTime) % 5 === 0) {
        const currentFile = fileInput.files[0];
        if (currentFile) {
            updateVideoHistory(currentFile.name, video.currentTime);
        }
    }
});

playPauseButton.addEventListener('click', () => {
    if (video.paused) {
        video.play();
        playPauseButton.textContent = 'Pause';
        scrollToVideo();
    } else {
        video.pause();
        playPauseButton.textContent = 'Play';
    }
});

rewindButton.addEventListener('click', () => {
    video.currentTime = Math.max(0, video.currentTime - 10);
});

forwardButton.addEventListener('click', () => {
    video.currentTime = Math.min(video.duration, video.currentTime + 10);
});

function formatTime(seconds) {
    if (isNaN(seconds)) return '0:00';
    const minutes = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60);
    return `${minutes}:${secs.toString().padStart(2, '0')}`;
}

function scrollToVideo() {
    const videoContainer = document.getElementById('video-container');
    videoContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
}
</script>
</body></html>
